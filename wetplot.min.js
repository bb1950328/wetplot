var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";
var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+e,e=
$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var g=0;g<f&&c<e;)if(d[c++]!=b[g++])return!1;return g>=f}},"es6","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.assign=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.assign?Object.assign:function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)$jscomp.owns(d,e)&&(a[e]=d[e])}return a};$jscomp.polyfill("Object.assign",function(a){return a||$jscomp.assign},"es6","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(e,f){this.$jscomp$symbol$id_=e;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:f})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c=0,d=function(e){if(this instanceof d)throw new TypeError("Symbol is not a constructor");return new b("jscomp_symbol_"+(e||"")+"_"+c++,e)};return d},"es6","es3");$jscomp.initSymbolIterator=function(){};
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");$jscomp.polyfill("Number.parseInt",function(a){return a||parseInt},"es6","es3");
var DEFAULT_LINE_CODE="###default###",WETPLOT_CSS="\n    .xAxisText {\n        fill: #000000;\n    }\n\n    .linePath {\n        fill: none;\n    }\n\n    .grid {\n        fill: none;\n        stroke: #666;\n    }\n\n    #hoverCursor {\n        stroke: #000;\n    }\n\n    .wetplot-button {\n        height: 2rem;\n        width: 2rem;\n        font-size: 1.8rem;\n        background-color: #aaaaaaaa;\n        text-align: center;\n        vertical-align: center;\n    }\n\n    .wetplot-button:hover {\n        background-color: #ccccccaa;\n    }\n\n    .wetplot-button:not(:last-child) {\n        margin-right: 0.25rem;\n    }\n\n    #wetplot-button-container {\n        z-index: 100;\n    }\n",COLOR_PALETTES=
[["#ff0000","#00ff00","#00ffff","#0000ff","#ff00ff"],"#ff0000 #ff8000 #80ff00 #00ff00 #00ff80 #00ffff #0080ff #0000ff #8000ff #ff00ff #ff0080".split(" ")],TEXTS={TIME:{en:"Time",de:"Zeit",fr:"Temps"}};function getText(a){var b=TEXTS[a];if(void 0===b)return"###"+a+"###";a=Object.getOwnPropertyNames(b);for(var c,d=!1,e=0;e<window.navigator.languages.length;e++)if(c=window.navigator.languages[e],c.startsWith("en")&&(c="en"),c in a){d=!0;break}d||(c=a[0]);return b[c]}
function createSvgElement(a){return document.createElementNS("http://www.w3.org/2000/svg",void 0===a?"svg":a)}function _split_to_digits(a){for(var b=[];a;)b.push(a%10),a=Math.floor(a/10);b.reverse();return b}
var Wetplot=function(){this._config={rows:[],container_id:"wetplot-container",width:1E3,height:500,background_color:"#c7c1a7",hover_box_background_color:"#fafafa",time_offset:Math.round((+new Date-864E5)/1E3),time_length:86400,seconds_per_pixel:60,seconds_per_grid_line:3600,num_horizontal_grid_lines:20,caching_enabled:!1,db_name:"wetplot",intervals:"10min 1hour 24hour 7days 1month 1year".split(" "),allow_scrolling_to_far:!1,font_size_px:16,show_zoom_buttons:!0};this._line_config={"###default###":{type:"line",
color:"#000000",line_width:2,name:"?",unit:"1",auto_min_max:!1,min:-1,max:25}};this._data=null;this._x_offset=0;this._created_y_axes=[];this._data_callback=null};
Wetplot.prototype.initialize=function(){this._svgElement=createSvgElement("svg");this._wrapperElement=document.getElementById(this._config.container_id);this._wrapperElement.appendChild(this._svgElement);this._wrapperElement.style.height=this._config.height+"px";this._wrapperElement.style.display="flex";this._svgElement.style.pointerEvents="none";this._svgElement.style.position="block";this._svgElement.style.width=this._config.width+"px";this._svgElement.style.height=this._config.height+"px";this._svgElement.style["background-color"]=
this._config.background_color;this._svgElement.setAttribute("width",this._config.width);this._svgElement.setAttribute("height",this._config.height);this._svgElement.setAttribute("viewBox","0 0 "+this._config.width+" "+this._config.height);this._add_style();this._addPanEventListeners();this._openDb();this._rebuildAllLines();this._create_y_axis();this._redraw_x_axis();this._redraw_horizontal_grid();this._createHoverCursor();this._show_buttons()};
Wetplot.prototype._openDb=function(a){a=void 0===a?function(d){}:a;var b=window.indexedDB.open(this._config.db_name,1),c=this._config.intervals;b.onerror=function(d){console.error(d.target.errorCode)};b.onsuccess=function(d){a(d.target.result)};b.onupgradeneeded=function(d){console.log("DB update needed");var e=d.target.result;c.forEach(function(f){e.createObjectStore(f,{keyPath:"Time"})})}};
Wetplot.prototype._addDataToDb=function(a,b){this._openDb(function(c){function d(f){console.debug("Add "+JSON.stringify(f));e.add(f)}c=c.transaction([a],"readwrite");var e=c.objectStore(a);b.forEachObject(function(f){var g=e.get(f.Time);g.onsuccess=function(h){h=g.result;if(void 0===h)d(f);else{var l=JSON.stringify(h);Object.assign(h,f);var k=JSON.stringify(h);l!==k&&(console.debug("Update "+l),e.put(h))}};g.onerror=function(h){d(f)}});c.onabort=function(f){console.error(f)}})};
Wetplot.prototype._getDataFromDb=function(a,b,c,d){this._openDb(function(e){var f=e.transaction(a).objectStore(a).getAll(IDBKeyRange.bound(b,c));f.onsuccess=function(g){d(WetplotData.fromObjectArray(f.result))}})};Wetplot.prototype._request_data=function(a,b,c){var d=this;this._getDataFromDb(a,b,c,function(e){null!==d._data_callback&&d._data_callback(a,b,c,function(f){d._addDataToDb(a,f)})})};Wetplot.prototype._add_style=function(){var a=document.createElement("style");a.textContent=WETPLOT_CSS;document.head.append(a)};
Wetplot.prototype._redraw_x_axis=function(){var a=document.getElementById("xAxisGroup");null===a&&(a=createSvgElement("g"),a.setAttribute("id","xAxisGroup"),this._svgElement.appendChild(a));var b=document.getElementById("xAxisGridPath");null===b&&(b=createSvgElement("path"),b.classList.add("grid"),b.setAttribute("id","xAxisGridPath"),this._svgElement.appendChild(b));for(var c=a.innerHTML="",d=this._config.seconds_per_grid_line,e=this._config.time_offset,f=this._config.font_size_px,g=Math.round(e/
d)*d;g<e+this._config.time_length;g+=d){var h=new Date(1E3*g),l=Math.round(this._seconds_to_x_coords(g));h=h.toLocaleDateString()+" "+h.toLocaleTimeString();h=h.substring(0,h.lastIndexOf(":"));var k=createSvgElement("text");k.innerHTML=h;k.setAttribute("x",0);k.setAttribute("y",f/4);k.setAttribute("transform","rotate(90,0,0) translate(10 "+-l+")");k.style.fontSize=f+"px";k.classList.add("xAxisText");a.appendChild(k);c+="M"+l+" 0 V "+this._config.height}b.setAttribute("d",c)};
Wetplot.prototype._redraw_horizontal_grid=function(){for(var a="",b=this._config.num_horizontal_grid_lines,c=this._config.height/(b+1),d=1;d<=b;d++)a+="M 0 "+Math.round(c*d)+" H "+this._getXmax();b=document.getElementById("horizontalGrid");null===b&&(b=createSvgElement("path"),b.setAttribute("id","horizontalGrid"),b.classList.add("grid"),this._svgElement.appendChild(b));b.setAttribute("d",a)};Wetplot.prototype._rebuildAllLines=function(){var a=this;this.getAllLineCodes().forEach(function(b){return a._rebuildLine(b)})};
Wetplot.prototype._rebuildLine=function(a){var b=this._data.heads.indexOf(a),c=this._data.heads.indexOf("Time"),d=this._line_config[a];if(d.auto_min_max){var e=$jscomp.makeIterator(this._data.getMinMaxForColumn(b)),f=e.next().value;e=e.next().value;var g=(e-f)/100;d.min=f-g;d.max=e+g}f=!1;if("line"===d.type){var h="M";e=!0;for(g=0;g<this._data.values.length;g++){var l=this._seconds_to_x_coords(this._data.values[g][c]),k=this._value_to_y_coord(a,this._data.values[g][b]);e?e=!1:h+=" L";h+=" "+Math.round(l)+
" "+Math.round(k)}}else if("ybar"===d.type){f=!0;h=void 0;k=g=this._config.time_offset;var m=l=0;e=[];for(var n=0;n<this._data.values.length;n++){var q=this._data.values[n][c],p=Math.floor(q/this._config.seconds_per_grid_line);void 0!==h&&h!==p&&(e.push([g,k,l]),g=q,m=Math.max(l,m),l=0);l+=this._data.values[n][b];h=p;k=q}d.auto_min_max&&(d.min=0,d.max=1.01*m);b=this._value_to_y_coord(a,0);h="M 0 "+b;for(c=0;c<e.length;c++)g=e[c][0],k=e[c][1],l=e[c][2],l=this._value_to_y_coord(a,l),g=this._seconds_to_x_coords(g)+
1,k=this._seconds_to_x_coords(k)-1,h+=" H "+g,h+=" V "+l,h+=" H "+k,h+=" V "+b;h+=" Z"}else console.error("Unknown type for line "+a+': "'+d.type+'"');console.log(h);b=document.getElementById("path"+a);null===b&&(b=createSvgElement("path"),this._svgElement.appendChild(b),b.classList.add("linePath"),b.setAttribute("id","path"+a));b.style.stroke=d.color;b.style.strokeWidth=d.line_width;f&&(b.style.fill=d.color,b.style.fillOpacity=.4);b.setAttribute("d",h)};
Wetplot.prototype._create_y_axis=function(){this._yAxisElement=createSvgElement("svg");this._wrapperElement.appendChild(this._yAxisElement);this._yAxisElement.setAttribute("width","0.01em");this._redraw_y_axis()};Wetplot.prototype._redraw_y_axis=function(){var a=this;this._created_y_axes=[];this._yAxisElement.setAttribute("height",this._config.height);this._yAxisElement.style.backgroundColor=this._config.background_color;this.getAllLineCodes().forEach(function(b){return a._add_y_axis_for_line_if_needed(b)})};
Wetplot.prototype._createHoverCursor=function(){var a=this,b=createSvgElement("g");this._svgElement.appendChild(b);b.setAttribute("id","hoverCursor");var c=createSvgElement("path");b.appendChild(c);c.setAttribute("d","M 0 0 V "+this._config.height);document.body.addEventListener("mousemove",function(d){a._cursorMoved(d)})};
Wetplot.prototype._cursorMoved=function(a){var b=document.getElementById("hoverCursor"),c=this._svgElement.getBoundingClientRect();c.x+2<a.clientX&&a.clientX<c.right-2&&c.y+2<a.clientY&&a.clientY<c.bottom-2?(b.style.display="inline",a=a.clientX-c.x,c=a+this._x_offset,b.setAttribute("transform","translate("+c+" 0)"),this._show_values_popup(c,a)):(b.style.display="none",this._hide_values_popup())};
Wetplot.prototype._nearestTwoDataRows=function(a){for(var b=null,c=null,d=this._data.heads.indexOf("Time"),e=0;e<this._data.values.length&&!(b=c,c=this._data.values[e],c[d]>a);e++);return[b,c]};
Wetplot.prototype._show_values_popup=function(a,b){var c=this,d=this._x_coords_to_seconds(a),e=document.getElementById("valuesPopupG"),f=document.getElementById("valuesPopupTime"),g=document.getElementById("valuesPopupBg"),h=function(r){return c._config.font_size_px*r};null==e?(e=createSvgElement("g"),e.setAttribute("id","valuesPopupG"),this._svgElement.appendChild(e),g=createSvgElement("path"),e.appendChild(g),g.style.fill=this._config.hover_box_background_color,g.style.fillOpacity=.75,g.setAttribute("id",
"valuesPopupBg"),f=createSvgElement("text"),f.setAttribute("id","valuesPopupTime"),f.style.fontSize=this._config.font_size_px+"px",e.appendChild(f)):e.style.display="inline";this.getAllLineCodes().forEach(function(r){r="valuesPopup"+r;var t=document.getElementById(r);null==t&&(t=createSvgElement("text"),t.style.fontSize=c._config.font_size_px+"px",t.classList.add("valueText"),t.setAttribute("id",r),e.appendChild(t))});var l=h(.25),k=h(1),m=(new Date(1E3*d)).toLocaleString();m=m.substring(0,m.lastIndexOf(":"));
f.innerHTML=getText("TIME")+": "+m;f.setAttribute("y",k);m=f.innerHTML.length;var n=this._seconds_to_values(d);d=e.getElementsByClassName("valueText");for(var q=0;q<d.length;q++){var p=d.item(q),u=p.id.substring(11),v=this._line_config[u].name+": "+Math.round(100*n[u])/100+" "+this._line_config[u].unit;p.innerHTML=v;m=Math.max(m,v.length);p.style.fill=this._line_config[u].color;k+=h(1);p.setAttribute("y",k)}m=2*Math.ceil(m/4.5);k+=h(.25);n=h(this.getAllLineCodes().length+1.25);q=(this._config.height+
n)/2;.5<b/this._config.width?(e.setAttribute("transform","translate("+(a-h(m+1))+", "+q+")"),g.setAttribute("transform","")):(e.setAttribute("transform","translate("+a+", "+q+")"),g.setAttribute("transform","rotate(180) translate("+h(-(m+1))+" "+-1*n+")"),l+=h(1));f.setAttribute("x",l);for(a=0;a<d.length;a++)d.item(a).setAttribute("x",l);g.setAttribute("d","M 0 0 H "+h(m)+" V "+.4*k+" L "+h(m+1)+" "+.5*k+" L "+h(m)+" "+.6*k+" V "+k+" H 0 V 0")};
Wetplot.prototype._hide_values_popup=function(){var a=document.getElementById("valuesPopupG");null!==a&&(a.style.display="none")};Wetplot.prototype.getAllLineCodes=function(){return Object.getOwnPropertyNames(this._line_config).filter(function(a){return a!==DEFAULT_LINE_CODE})};
Wetplot.prototype.numberToDisplayText=function(a,b,c){void 0===c&&(c=a);if(2E3>=c)return a.toFixed(b);b=["","k","m","g","t"];a=_split_to_digits(a);for(c="";4<a.length+(c?1:0);)c=b[b.indexOf(c)+1],5<=a.splice(a.length-3,3)[0]&&(a=_split_to_digits(Number.parseInt(a.join(""))+1));return a.join("")+c};
Wetplot.prototype._get_visible_min_max_for_unit=function(a){var b=this,c=$jscomp.makeIterator([void 0,void 0]),d=c.next().value,e=c.next().value;this.getAllLineCodes().forEach(function(f){if(b._line_config[f].unit===a){var g=$jscomp.makeIterator([b._line_config[f].min,b._line_config[f].max]);f=g.next().value;g=g.next().value;void 0===d?(d=f,e=g):(d=Math.min(f,d),e=Math.max(g,e))}});return[d,e]};
Wetplot.prototype._count_visible_units=function(){var a=this,b=[];this.getAllLineCodes().forEach(function(c){c=a._line_config[c].unit;-1===b.indexOf(c)&&b.push(c)});return b.length};
Wetplot.prototype._add_y_axis_for_line_if_needed=function(a){var b=this._line_config[a].unit,c="group"+this._unit_to_id(b);if(-1===this._created_y_axes.indexOf(c)&&this._yAxisElement){this._created_y_axes.push(c);var d=this._config.font_size_px;this.getAllLineCodes();this._yAxisElement.setAttribute("width",4*this._count_visible_units()*d);var e=this._created_y_axes.length-1;console.log("creating y axis for unit "+b+";"+e);var f=this._yAxisElement.getElementById(c);f&&(this._yAxisElement.removeChild(f),console.debug("removed old y axis with id "+
c));f=createSvgElement("g");f.setAttribute("id",c);f.setAttribute("fill",this._line_config[a].color);this._yAxisElement.appendChild(f);c=createSvgElement("text");f.appendChild(c);c.innerHTML=b;c.style.fontSize=d+"px";c.setAttribute("y",d);c.setAttribute("x",(4*e+.5)*d);b=$jscomp.makeIterator(this._get_visible_min_max_for_unit(b));var g=b.next().value;b=b.next().value;c=1.2*d/(this._config.height/(b-g));b=0;if(.5>c){for(b=1; .05>c;)b++,c*=10;c=(.1>c?.1:.2>c?.2:.5)/Math.pow(10,b-1)}else c=Math.ceil(c);if(0===
c)console.warn("something is wrong, i can feel it");else{var h=this._config.height-d;for(g=Math.floor(g);this._value_to_y_coord(a,g)>h;)g+=c;var l=this._value_to_y_coord(a,g);h="";var k=l;for(e=4*(e+.15)*d;l>2*d;){var m=l;var n=createSvgElement("text");n.innerHTML=this.numberToDisplayText(g,b);n.setAttribute("y",l+.4*d);n.setAttribute("x",e+d/3);n.style.fontSize=d+"px";f.appendChild(n);h+="M "+e+" "+l+" h "+(d/-3).toFixed(2)+" ";g+=c;l=this._value_to_y_coord(a,g)}h+="M "+e+" "+m+" V "+k;d=createSvgElement("path");
d.setAttribute("d",h);d.setAttribute("id","yLadder"+a);d.setAttribute("stroke",this._line_config[a].color);f.appendChild(d)}}};Wetplot.prototype._unit_to_id=function(a){for(a=encodeURI(a.replace("\u00b0","deg").replace("%","percent"));-1!==a.indexOf("%");)a=a.replace("%","");return a};Wetplot.prototype.config=function(a,b){void 0!==b&&(this._config[a]=b);return this._config[a]};
Wetplot.prototype.addLine=function(a){if(a===DEFAULT_LINE_CODE)throw Error("invalid lineId");this._line_config[a]=Object.assign({},this._line_config[DEFAULT_LINE_CODE]);this._line_config[a].name=a;this._add_y_axis_for_line_if_needed(a)};Wetplot.prototype.lineConfig=function(a,b,c){void 0!==c&&(this._line_config[a][b]=c);return this._line_config[a][b]};Wetplot.prototype.addWetplotData=function(a){this._addDataToDb("10min",a);this._data=null===this._data?a:WetplotData.concatenate(this._data,a)};
Wetplot.prototype.usePalette=function(a){a=COLOR_PALETTES[a];var b=this.getAllLineCodes();if(a)for(var c=0;c<b.length;c++)this.lineConfig(b[c],"color",a[c%a.length])};
Wetplot.prototype._moveViewBoxPixels=function(a,b){a=void 0===a?0:a;b=void 0===b?!1:b;if(a){var c=$jscomp.makeIterator(this._svgElement.getAttribute("viewBox").split(" ")),d=c.next().value,e=c.next().value,f=c.next().value;c=c.next().value;d=b?a:Number.parseInt(d)+a;this._config.allow_scrolling_to_far||(d=Math.max(0,d),a=this._getXmax()-this._config.width,d=Math.min(d,a));e=[d,e,f,c].join(" ");this._x_offset=d;this._svgElement.setAttribute("viewBox",e)}};
Wetplot.prototype._getXmax=function(){return this._seconds_to_x_coords(this._config.time_offset+this._config.time_length)};
Wetplot.prototype._addPanEventListeners=function(){var a=this,b=this._wrapperElement,c;b.onwheel=function(d){d.preventDefault();a._moveViewBoxPixels(10*d.deltaX);a._moveViewBoxPixels(10*d.deltaY);a._cursorMoved(d)};b.onmousedown=function(d){function e(){document.removeEventListener("mousemove",f);b.onmouseup=null}d.preventDefault();c=d.pageX;var f=function(g){2>=g.pageX||g.pageX-2>window.innerWidth?e():(a._moveViewBoxPixels(c-g.pageX),c=g.pageX)};document.addEventListener("mousemove",f);b.onmouseup=
e}};Wetplot.prototype._seconds_to_x_coords=function(a){return Math.round((a-this._config.time_offset)/this._config.seconds_per_pixel)};Wetplot.prototype._x_coords_to_seconds=function(a){return a*this._config.seconds_per_pixel+this._config.time_offset};Wetplot.prototype._value_to_y_coord=function(a,b){var c=$jscomp.makeIterator(this._get_visible_min_max_for_unit(this._line_config[a].unit));a=c.next().value;c=c.next().value;return this._config.height-(b-a)/(c-a)*this._config.height};
Wetplot.prototype._y_coord_to_value=function(a,b){var c=$jscomp.makeIterator(this._get_visible_min_max_for_unit(this._line_config[a].unit));a=c.next().value;c=c.next().value;return(this._config.height-b)/this._config.height*(c-a)+a};
Wetplot.prototype._seconds_to_values=function(a){var b=this,c=$jscomp.makeIterator(this._nearestTwoDataRows(a)),d=c.next().value,e=c.next().value,f={};if(null!==d||null!==e){null===d?d=e:null===e&&(e=d);c=this._data.heads.indexOf("Time");var g=d[c],h=(a-g)/(e[c]-g);this.getAllLineCodes().forEach(function(l){var k=b._data.heads.indexOf(l),m=d[k];f[l]=m+(e[k]-m)*h})}return f};Wetplot.prototype.scrollTo=function(a){this._moveViewBoxPixels(a,!0)};
Wetplot.prototype.zoomIn=function(){this._config.seconds_per_pixel/=2;this._config.seconds_per_grid_line/=2;this._redraw_all()};Wetplot.prototype.zoomOut=function(){this._config.seconds_per_pixel*=2;this._config.seconds_per_grid_line*=2;this._redraw_all()};
Wetplot.prototype._show_buttons=function(){var a=this,b=[];if(this._config.show_zoom_buttons){var c=document.createElement("div"),d=document.createElement("div");c.innerText="+";d.innerText="-";c.addEventListener("click",function(f){return a.zoomIn()});d.addEventListener("click",function(f){return a.zoomOut()});b.push(c);b.push(d)}if(0<b.length){var e=document.createElement("div");e.setAttribute("id","wetplot-button-container");e.style.position="absolute";e.style.display="flex";e.style.flexDirection=
"row";this._wrapperElement.appendChild(e);b.forEach(function(f){f.classList.add("wetplot-button");e.appendChild(f)})}};Wetplot.prototype._redraw_all=function(){console.log("TODO: redraw everything");var a=Math.floor(this._config.width/2),b=this._x_coords_to_seconds(this._x_offset+a);this._redraw_y_axis();this._redraw_x_axis();this._redraw_horizontal_grid();this._rebuildAllLines();this._moveViewBoxPixels(this._seconds_to_x_coords(b)-a,!0)};
$jscomp.global.Object.defineProperties(Wetplot.prototype,{data_callback:{configurable:!0,enumerable:!0,get:function(){return this._data_callback},set:function(a){this._data_callback=a}}});var WetplotData=function(a,b){a=void 0===a?[]:a;b=void 0===b?[]:b;this.heads=a;this.values=b};WetplotData.prototype.getValue=function(a,b){return(a=this.values[a])?a[this.getColumnIndex(b)]:void 0};WetplotData.prototype.getColumnIndex=function(a){return this.heads.indexOf(a)};
WetplotData.concatenate=function(a,b){var c=new WetplotData;a.heads.forEach(c.heads.push);b.heads.forEach(function(p){-1===c.heads.indexOf(p)&&c.push(p)});var d=a.getValue(0,"Time"),e=b.getValue(0,"Time"),f=Math.min(d,e);e=d=0;var g={},h={};for(c.heads.forEach(function(p){g[p]=a.getColumnIndex(p);h[p]=b.getColumnIndex(p)});d<a.values.length||e<b.values.length;){var l=a.getValue(d,"Time")-f,k=b.getValue(e,"Time")-f;if(isNaN(k)||l<=k){var m=[],n=a.values[d],q=$jscomp.makeIterator(c.heads);for(f=q.next();!f.done;f=
q.next())m.push(n[g[f.value]]);c.values.push(m);f=a.getValue(d,"Time");d++}if(isNaN(l)||k<=l){l=[];k=b.values[e];m=$jscomp.makeIterator(c.heads);for(f=m.next();!f.done;f=m.next())l.push(k[h[f.value]]);c.values.push(l);f=b.getValue(e,"Time");e++}}return c};WetplotData._add_columns=function(a,b,c){c=void 0===c?null:c;var d=b.length;if(!(0>=d)){for(var e=a.values.length,f=0;f<e;f++)for(var g=0;g<d;g++)a.values[f].push(c);b.forEach(function(h){return a.heads.push(h)})}};
WetplotData.prototype.forEachObject=function(a){var b=this,c={};this.values.forEach(function(d){for(var e=0;e<b.heads.length;e++)c[b.heads[e]]=d[e];a(Object.assign({},c))})};
WetplotData.fromObjectArray=function(a){a=void 0===a?[]:a;var b=new WetplotData;a.forEach(function(c){var d=[];Object.getOwnPropertyNames(c).forEach(function(e){var f=b.heads.indexOf(e);-1===f&&(f=b.heads.length,b.heads.push(e));d[f]=c[e]});b.values.push(d)});b.values.sort(function(c,d){return c.Time>d.Time?1:d.Time>c.Time?-1:0});return b};
WetplotData.prototype.getMinMaxForColumn=function(a){a=void 0===a?0:a;for(var b=void 0,c=void 0,d=0;d<this.values.length;d++){var e=this.values[d][a];if(e<b||void 0===b)b=e;if(e>c||void 0===c)c=e}return[b,c]};
WetplotData.prototype.getMissingTimespans=function(a,b,c,d){d=void 0===d?.5:d;var e=this.getColumnIndex("Time"),f=[],g=this.values[0][e];g-a>c&&f.push([a,g]);g=this.values[this.values.length-1][e];b-g>c&&f.push([g,b]);for(a=1;a<this.values.length-2;a++)b=this.values[a][e],g=this.values[a+1][e],g-b>c&&f.push([b,g]);for(e=0;e<f.length;e++)b=$jscomp.makeIterator(f[e]),a=b.next().value,b=b.next().value,f[e]=[a+d*c,b-d*c];return f};
