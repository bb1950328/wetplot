var DEFAULT_LINE_CODE="###default###";var WETPLOT_CSS="\n    .xAxisText {\n        fill: #000000;\n    }\n\n    .linePath {\n        fill: none;\n    }\n\n    .grid {\n        fill: none;\n        stroke: #666;\n    }\n\n    #hoverCursor {\n        stroke: #000;\n    }\n";var COLOR_PALETTES=[["#ff0000","#00ff00","#00ffff","#0000ff","#ff00ff"],["#ff0000","#ff8000","#80ff00","#00ff00","#00ff80","#00ffff","#0080ff","#0000ff","#8000ff","#ff00ff","#ff0080"]];
var TEXTS={"TIME":{"en":"Time","de":"Zeit","fr":"Temps"}};function getText(key){var object=TEXTS[key];if(object===undefined)return"###"+key+"###";else{var availableLanguages=Object.getOwnPropertyNames(object);var lang;var found=false;for(var i=0;i<window.navigator.languages.length;i++){lang=window.navigator.languages[i];if(lang.startsWith("en"))lang="en";if(lang in availableLanguages){found=true;break}}if(!found)lang=availableLanguages[0];return object[lang]}}
function createSvgElement(tagName){tagName=tagName===undefined?"svg":tagName;return document.createElementNS("http://www.w3.org/2000/svg",tagName)}function _split_to_digits(value){var digits=[];while(value){digits.push(value%10);value=Math.floor(value/10)}digits.reverse();return digits}
var Wetplot=function(){this._config={rows:[],container_id:"wetplot-container",width:1E3,height:500,background_color:"#c7c1a7",hover_box_background_color:"#fafafa",time_offset:Math.round((+new Date-1E3*60*60*24)/1E3),time_lenght:60*60*24*2,seconds_per_pixel:60,seconds_per_grid_line:3600,num_horizontal_grid_lines:20,caching_enabled:false,db_name:"wetplot",intervals:["10min","1hour","24hour","7days","1month","1year"],allow_scrolling_to_far:false,font_size_px:16};this._line_config={"###default###":{"type":"line",
"color":"#000000","line_width":2,"name":"?","unit":"1","auto_min_max":false,"min":-1,"max":25}};this._data=null;this._x_offset=0;this._created_y_axes=[]};
Wetplot.prototype.initialize=function(){this._svgElement=createSvgElement("svg");this._wrapperElement=document.getElementById(this._config["container_id"]);this._wrapperElement.appendChild(this._svgElement);this._wrapperElement.style["height"]=this._config["height"]+"px";this._wrapperElement.style.display="flex";this._svgElement.style.pointerEvents="none";this._svgElement.style.position="block";this._svgElement.style["width"]=this._config["width"]+"px";this._svgElement.style["height"]=this._config["height"]+
"px";this._svgElement.style["background-color"]=this._config["background_color"];this._svgElement.setAttribute("width",this._config["width"]);this._svgElement.setAttribute("height",this._config["height"]);this._svgElement.setAttribute("viewBox","0 0 "+this._config["width"]+" "+this._config["height"]);this._add_style();this._addPanEventListeners();this._openDb();this._rebuildAllLines();this._create_y_axis();this._draw_x_axis();this._draw_horizontal_grid();this._createHoverCursor()};
Wetplot.prototype._openDb=function(successCallback){successCallback=successCallback===undefined?function(db){}:successCallback;var request=window.indexedDB.open(this._config["db_name"],1);var time_intervals=this._config["intervals"];request.onerror=function(event){console.error(event.target.errorCode)};request.onsuccess=function(event){var db=event.target.result;successCallback(db)};request.onupgradeneeded=function(event){console.log("DB update needed");var db=event.target.result;time_intervals.forEach(function(interval){var objectStore=
db.createObjectStore(interval,{keyPath:"Time"})})}};
Wetplot.prototype._addDataToDb=function(interval,wetplotData){this._openDb(function(db){var transaction=db.transaction([interval],"readwrite");var objectStore=transaction.objectStore(interval);function addObj(obj){console.debug("Add "+JSON.stringify(obj));objectStore.add(obj)}function updateObj(obj,previous){if(previous===undefined)return addObj(obj);console.debug("Update "+JSON.stringify(previous));Object.assign(previous,obj);objectStore.put(previous)}wetplotData.forEachObject(function(obj){var request=
objectStore.get(obj["Time"]);request.onsuccess=function(event){updateObj(obj,request.result)};request.onerror=function(event){addObj(obj)}});transaction.onabort=function(event){console.error(event)}})};Wetplot.prototype._getDataFromDb=function(interval,startTs,endTs,callback){this._openDb(function(db){var transaction=db.transaction(interval);var objectStore=transaction.objectStore(interval);var request=objectStore.getAll(IDBKeyRange.bound(startTs,endTs));request.onsuccess=function(event){callback(WetplotData.fromObjectArray(request.result))}})};
Wetplot.prototype._add_style=function(){var style=document.createElement("style");style.textContent=WETPLOT_CSS;document.head.append(style)};
Wetplot.prototype._draw_x_axis=function(){var group=createSvgElement("g");group.setAttribute("id","xAxisGroup");this._svgElement.appendChild(group);var gridPath=createSvgElement("path");var gridD="";var seconds_step=this._config["seconds_per_grid_line"];var seconds_start=this._config["time_offset"];var fontSize=this._config["font_size_px"];for(var secs=Math.round(seconds_start/seconds_step)*seconds_step;secs<seconds_start+this._config["time_lenght"];secs+=seconds_step){var date=new Date(secs*1E3);
var x=Math.round(this._seconds_to_x_coords(secs));var dateForHuman=date.toLocaleDateString()+" "+date.toLocaleTimeString();dateForHuman=dateForHuman.substring(0,dateForHuman.lastIndexOf(":"));var txt=createSvgElement("text");txt.innerHTML=dateForHuman;txt.setAttribute("x",0);txt.setAttribute("y",fontSize/4);txt.setAttribute("transform","rotate(90,0,0) translate("+10+" "+-x+")");txt.style.fontSize=fontSize+"px";txt.classList.add("xAxisText");group.appendChild(txt);gridD+="M"+x+" 0 V "+this._config["height"]}gridPath.setAttribute("d",
gridD);gridPath.classList.add("grid");this._svgElement.appendChild(gridPath)};Wetplot.prototype._draw_horizontal_grid=function(){var gridD="";var num=this._config["num_horizontal_grid_lines"];var dist=this._config["height"]/(num+1);for(var i=1;i<=num;i++){var y=Math.round(dist*i);gridD+="M 0 "+y+" H "+this._getXmax()}var pathElement=createSvgElement("path");pathElement.setAttribute("id","horizontalGrid");pathElement.setAttribute("d",gridD);pathElement.classList.add("grid");this._svgElement.appendChild(pathElement)};
Wetplot.prototype._rebuildAllLines=function(){var $jscomp$this=this;this.getAllLineCodes().forEach(function(lineCode){return $jscomp$this._rebuildLine(lineCode)})};
Wetplot.prototype._rebuildLine=function(lineCode){var colNum=this._data.heads.indexOf(lineCode);var timeCol=this._data.heads.indexOf("Time");var config=this._line_config[lineCode];if(config["auto_min_max"]){var $jscomp$destructuring$var0=$jscomp.makeIterator(this._data.getMinMaxForColumn(colNum));var min=$jscomp$destructuring$var0.next().value;var max=$jscomp$destructuring$var0.next().value;var padding=(max-min)/100;config["min"]=min-padding;config["max"]=max+padding}var path;var fill=false;if(config["type"]===
"line"){path="M";var first=true;for(var i=0;i<this._data.values.length;i++){var x=this._seconds_to_x_coords(this._data.values[i][timeCol]);var y=this._value_to_y_coord(lineCode,this._data.values[i][colNum]);if(first)first=false;else path+=" L";path+=" "+Math.round(x)+" "+Math.round(y)}}else if(config["type"]==="ybar"){fill=true;var changingProperty=function(timestampSec){return(new Date(timestampSec*1E3)).getHours()};var lastPropertyValue=undefined;var aTs=this._config["time_offset"];var lastTimestamp=
aTs;var sum=0;var sumMax=0;var data=[];for(var i$0=0;i$0<this._data.values.length;i$0++){var ts=this._data.values[i$0][timeCol];var nowPropertyValue=changingProperty(ts);if(lastPropertyValue!==undefined&&lastPropertyValue!==nowPropertyValue){data.push([aTs,lastTimestamp,sum]);aTs=ts;sumMax=Math.max(sum,sumMax);sum=0}sum+=this._data.values[i$0][colNum];lastPropertyValue=nowPropertyValue;lastTimestamp=ts}if(config["auto_min_max"]){config["min"]=0;config["max"]=sumMax*1.01}var y_zero=this._value_to_y_coord(lineCode,
0);path="M 0 "+y_zero;for(var i$1=0;i$1<data.length;i$1++){aTs=data[i$1][0];var bTs=data[i$1][1];sum=data[i$1][2];var y$2=this._value_to_y_coord(lineCode,sum);var x1=this._seconds_to_x_coords(aTs)+1;var x2=this._seconds_to_x_coords(bTs)-1;path+=" H "+x1;path+=" V "+y$2;path+=" H "+x2;path+=" V "+y_zero}path+=" Z"}else console.error("Unknown type for line "+lineCode+': "'+config["type"]+'"');console.log(path);var pathElement=document.getElementById("path"+lineCode);if(pathElement===null){pathElement=
createSvgElement("path");this._svgElement.appendChild(pathElement);pathElement.style.stroke=config["color"];pathElement.style.strokeWidth=config["line_width"];pathElement.classList.add("linePath");if(fill){pathElement.style.fill=config["color"];pathElement.style.fillOpacity=.4}}pathElement.setAttribute("d",path)};
Wetplot.prototype._create_y_axis=function(){var $jscomp$this=this;this._yAxisElement=createSvgElement("svg");this._yAxisElement.setAttribute("width","0.01em");this._yAxisElement.setAttribute("height",this._config["height"]);this._yAxisElement.style.backgroundColor=this._config["background_color"];this.getAllLineCodes().forEach(function(code){return $jscomp$this._add_y_axis_for_line_if_needed(code)});this._wrapperElement.appendChild(this._yAxisElement)};
Wetplot.prototype._createHoverCursor=function(){var $jscomp$this=this;var g=createSvgElement("g");this._svgElement.appendChild(g);g.setAttribute("id","hoverCursor");var line=createSvgElement("path");g.appendChild(line);line.setAttribute("d","M 0 0 V "+this._config["height"]);var catchelement=document.body;catchelement.addEventListener("mousemove",function(event){$jscomp$this._cursorMoved(event)})};
Wetplot.prototype._cursorMoved=function(event){var g=document.getElementById("hoverCursor");var bbox=this._svgElement.getBoundingClientRect();var m=2;var inside=bbox.x+m<event.clientX&&event.clientX<bbox.right-m&&bbox.y+m<event.clientY&&event.clientY<bbox.bottom-m;if(inside){g.style.display="inline";var x_on_viewbox=event.clientX-bbox.x;var x_on_svg=x_on_viewbox+this._x_offset;g.setAttribute("transform","translate("+x_on_svg+" 0)");this._show_values_popup(x_on_svg,x_on_viewbox)}else{g.style.display=
"none";this._hide_values_popup()}};Wetplot.prototype._nearestTwoDataRows=function(timestamp){var a=null;var b=null;var time_idx=this._data.heads.indexOf("Time");for(var i=0;i<this._data.values.length;i++){a=b;b=this._data.values[i];if(b[time_idx]>timestamp)break}return[a,b]};
Wetplot.prototype._show_values_popup=function(x_svg,x_viewbox){var $jscomp$this=this;var cursorTimestampSeconds=this._x_coords_to_seconds(x_svg);var valuesPopupG=document.getElementById("valuesPopupG");var timeText=document.getElementById("valuesPopupTime");var bgPath=document.getElementById("valuesPopupBg");var scale=function(x){return $jscomp$this._config["font_size_px"]*x};if(valuesPopupG==null){valuesPopupG=createSvgElement("g");valuesPopupG.setAttribute("id","valuesPopupG");this._svgElement.appendChild(valuesPopupG);
bgPath=createSvgElement("path");valuesPopupG.appendChild(bgPath);bgPath.style.fill=this._config["hover_box_background_color"];bgPath.style.fillOpacity=.75;bgPath.setAttribute("id","valuesPopupBg");timeText=createSvgElement("text");timeText.setAttribute("id","valuesPopupTime");timeText.style.fontSize=this._config["font_size_px"]+"px";valuesPopupG.appendChild(timeText)}else valuesPopupG.style.display="inline";this.getAllLineCodes().forEach(function(lineCode){var id="valuesPopup"+lineCode;var txt=document.getElementById(id);
if(txt==null){txt=createSvgElement("text");txt.style.fontSize=$jscomp$this._config["font_size_px"]+"px";txt.classList.add("valueText");txt.setAttribute("id",id);valuesPopupG.appendChild(txt)}});var texts_x1=scale(.25);var texts_y=scale(1);var date=new Date(cursorTimestampSeconds*1E3);var localeDateStr=date.toLocaleString();localeDateStr=localeDateStr.substring(0,localeDateStr.lastIndexOf(":"));timeText.innerHTML=getText("TIME")+": "+localeDateStr;timeText.setAttribute("y",texts_y);var maxTxtLength=
timeText.innerHTML.length;var values=this._seconds_to_values(cursorTimestampSeconds);var valueElements=valuesPopupG.getElementsByClassName("valueText");for(var i=0;i<valueElements.length;i++){var txt=valueElements.item(i);var lineCode=txt.id.substring("valuesPopup".length);var text=this._line_config[lineCode]["name"]+": "+Math.round(values[lineCode]*100)/100+" "+this._line_config[lineCode]["unit"];txt.innerHTML=text;maxTxtLength=Math.max(maxTxtLength,text.length);txt.style.fill=this._line_config[lineCode]["color"];
texts_y+=scale(1);txt.setAttribute("y",texts_y)}var bgWidth=Math.ceil(maxTxtLength/4.5)*2;var bgHeight=texts_y+scale(.25);var estimatedBgHeight=scale(this.getAllLineCodes().length+1.25);var abs_y1=(this._config["height"]+estimatedBgHeight)/2;if(x_viewbox/this._config["width"]>.5){valuesPopupG.setAttribute("transform","translate("+(x_svg-scale(bgWidth+1))+", "+abs_y1+")");bgPath.setAttribute("transform","")}else{valuesPopupG.setAttribute("transform","translate("+x_svg+", "+abs_y1+")");bgPath.setAttribute("transform",
"rotate(180) translate("+scale(-(bgWidth+1))+" "+-1*estimatedBgHeight+")");texts_x1+=scale(1)}timeText.setAttribute("x",texts_x1);for(var i$3=0;i$3<valueElements.length;i$3++){var txt$4=valueElements.item(i$3);txt$4.setAttribute("x",texts_x1)}bgPath.setAttribute("d","M "+0+" 0"+" H "+scale(bgWidth)+" V "+bgHeight*.4+" L "+scale(bgWidth+1)+" "+.5*bgHeight+" L "+scale(bgWidth)+" "+.6*bgHeight+" V "+bgHeight+" H 0"+" V 0")};
Wetplot.prototype._hide_values_popup=function(){var valuesPopupG=document.getElementById("valuesPopupG");if(valuesPopupG!==null)valuesPopupG.style.display="none"};Wetplot.prototype.getAllLineCodes=function(){return Object.getOwnPropertyNames(this._line_config).filter(function(el){return el!==DEFAULT_LINE_CODE})};
Wetplot.prototype.numberToDisplayText=function(value,digitsAfterComma,maximum){if(maximum===undefined)maximum=value;if(maximum<=2E3)return value.toFixed(digitsAfterComma);var all_suffixes=["","k","m","g","t"];var digits=_split_to_digits(value);var suffix="";while(digits.length+(suffix?1:0)>4){suffix=all_suffixes[all_suffixes.indexOf(suffix)+1];var rest=digits.splice(digits.length-3,3);if(rest[0]>=5)digits=_split_to_digits(Number.parseInt(digits.join(""))+1)}return digits.join("")+suffix};
Wetplot.prototype._get_min_max_for_unit=function(unit){var $jscomp$this=this;var $jscomp$destructuring$var1=$jscomp.makeIterator([undefined,undefined]);var minVal=$jscomp$destructuring$var1.next().value;var maxVal=$jscomp$destructuring$var1.next().value;this.getAllLineCodes().forEach(function(c){if($jscomp$this._line_config[c]["unit"]===unit){var $jscomp$destructuring$var2=$jscomp.makeIterator([$jscomp$this._line_config[c]["min"],$jscomp$this._line_config[c]["max"]]);var minC=$jscomp$destructuring$var2.next().value;
var maxC=$jscomp$destructuring$var2.next().value;if(minVal===undefined){minVal=minC;maxVal=maxC}else{minVal=Math.min(minC,minVal);maxVal=Math.max(maxC,maxVal)}}});return[minVal,maxVal]};Wetplot.prototype._count_units=function(){var $jscomp$this=this;var units=[];this.getAllLineCodes().forEach(function(c){var u=$jscomp$this._line_config[c]["unit"];if(units.indexOf(u)===-1)units.push(u)});return units.length};
Wetplot.prototype._add_y_axis_for_line_if_needed=function(code){var Y_AXIS_WIDTH=4;var unit=this._line_config[code]["unit"];var id="group"+this._unit_to_id(unit);if(this._created_y_axes.indexOf(id)===-1&&this._yAxisElement){this._created_y_axes.push(id);var fontSize=this._config["font_size_px"];var allCodes=this.getAllLineCodes();this._yAxisElement.setAttribute("width",this._count_units()*Y_AXIS_WIDTH*fontSize);var index=this._created_y_axes.length-1;console.log("creating y axis for unit "+unit+";"+
index);var g=createSvgElement("g");g.setAttribute("id",id);g.setAttribute("fill",this._line_config[code]["color"]);this._yAxisElement.appendChild(g);var unitElement=createSvgElement("text");g.appendChild(unitElement);unitElement.innerHTML=unit;unitElement.style.fontSize=fontSize+"px";unitElement.setAttribute("y",fontSize);unitElement.setAttribute("x",(index*Y_AXIS_WIDTH+.5)*fontSize);var $jscomp$destructuring$var3=$jscomp.makeIterator(this._get_min_max_for_unit(unit));var minVal=$jscomp$destructuring$var3.next().value;
var maxVal=$jscomp$destructuring$var3.next().value;var minValueStep=fontSize*1.2/(this._config["height"]/(maxVal-minVal));var yValueDigitsAfterComma=0;var yValueStep;if(minValueStep<.5){yValueDigitsAfterComma=1;var stp=minValueStep;while(stp<.05){yValueDigitsAfterComma++;stp*=10}if(stp<.1)stp=.1;else if(stp<.2)stp=.2;else stp=.5;stp/=Math.pow(10,yValueDigitsAfterComma-1);yValueStep=stp}else yValueStep=Math.ceil(minValueStep);if(yValueStep===0){console.warn("something is wrong, i can feel it");return}var yMaxCoord=
this._config["height"]-fontSize;var yValue=Math.floor(minVal);while(this._value_to_y_coord(code,yValue)>yMaxCoord)yValue+=yValueStep;var yCoord=this._value_to_y_coord(code,yValue);var ladderPath="";var yFirstCoord=yCoord;var yLastCoord;var x=(index+.15)*Y_AXIS_WIDTH*fontSize;while(yCoord>fontSize*2){yLastCoord=yCoord;var txt=createSvgElement("text");txt.innerHTML=this.numberToDisplayText(yValue,yValueDigitsAfterComma);txt.setAttribute("y",yCoord+fontSize*.4);txt.setAttribute("x",x+fontSize/3);txt.style.fontSize=
fontSize+"px";g.appendChild(txt);ladderPath+="M "+x+" "+yCoord+" h "+(fontSize/-3).toFixed(2)+" ";yValue+=yValueStep;yCoord=this._value_to_y_coord(code,yValue)}ladderPath+="M "+x+" "+yLastCoord+" V "+yFirstCoord;var pathElement=createSvgElement("path");pathElement.setAttribute("d",ladderPath);pathElement.setAttribute("id","yLadder"+code);pathElement.setAttribute("stroke",this._line_config[code]["color"]);g.appendChild(pathElement)}};
Wetplot.prototype._unit_to_id=function(unit){var id=encodeURI(unit.replace("\u00b0","deg").replace("%","percent"));while(id.indexOf("%")!==-1)id=id.replace("%","");return id};Wetplot.prototype.config=function(key,value){if(value!==undefined)this._config[key]=value;return this._config[key]};
Wetplot.prototype.addLine=function(lineId){if(lineId===DEFAULT_LINE_CODE)throw Error("invalid lineId");this._line_config[lineId]=Object.assign({},this._line_config[DEFAULT_LINE_CODE]);this._line_config[lineId]["name"]=lineId;this._add_y_axis_for_line_if_needed(lineId)};Wetplot.prototype.lineConfig=function(lineId,property,value){if(value!==undefined)this._line_config[lineId][property]=value;return this._line_config[lineId][property]};
Wetplot.prototype.add2dArrayData=function(heads,values){var newData=new WetplotData(heads,values);if(this._data===null)this._data=newData;else this._data=WetplotData.concatenate(this._data,newData)};Wetplot.prototype.usePalette=function(paletteIndex){var pal=COLOR_PALETTES[paletteIndex];var codes=this.getAllLineCodes();if(pal)for(var i=0;i<codes.length;i++)this.lineConfig(codes[i],"color",pal[i%pal.length])};
Wetplot.prototype._moveViewBoxPixels=function(deltaPx){deltaPx=deltaPx===undefined?0:deltaPx;if(!deltaPx)return;var $jscomp$destructuring$var4=$jscomp.makeIterator(this._svgElement.getAttribute("viewBox").split(" "));var x1=$jscomp$destructuring$var4.next().value;var y1=$jscomp$destructuring$var4.next().value;var x2=$jscomp$destructuring$var4.next().value;var y2=$jscomp$destructuring$var4.next().value;x1=Number.parseInt(x1)+deltaPx;if(!this._config["allow_scrolling_to_far"]){x1=Math.max(0,x1);var x1max=
this._getXmax()-this._config["width"];x1=Math.min(x1,x1max)}var newValue=[x1,y1,x2,y2].join(" ");this._x_offset=x1;this._svgElement.setAttribute("viewBox",newValue)};Wetplot.prototype._getXmax=function(){return this._seconds_to_x_coords(this._config["time_offset"]+this._config["time_lenght"])};
Wetplot.prototype._addPanEventListeners=function(){var $jscomp$this=this;var wrapperElement=this._wrapperElement;var _last_mouse_move_x;wrapperElement.onwheel=function(event){event.preventDefault();$jscomp$this._moveViewBoxPixels(event.deltaX*10);$jscomp$this._moveViewBoxPixels(event.deltaY*10);$jscomp$this._cursorMoved(event)};wrapperElement.onmousedown=function(event){event.preventDefault();_last_mouse_move_x=event.pageX;var onMouseMove=function(event){if(event.pageX<=2||event.pageX-2>window.innerWidth){stopDrag();
return}var delta=_last_mouse_move_x-event.pageX;$jscomp$this._moveViewBoxPixels(delta);_last_mouse_move_x=event.pageX};document.addEventListener("mousemove",onMouseMove);function stopDrag(){document.removeEventListener("mousemove",onMouseMove);wrapperElement.onmouseup=null}wrapperElement.onmouseup=stopDrag}};Wetplot.prototype._seconds_to_x_coords=function(seconds){return Math.round((seconds-this._config["time_offset"])/this._config["seconds_per_pixel"])};
Wetplot.prototype._x_coords_to_seconds=function(x_coord){return x_coord*this._config["seconds_per_pixel"]+this._config["time_offset"]};Wetplot.prototype._value_to_y_coord=function(lineCode,value){var $jscomp$destructuring$var5=$jscomp.makeIterator(this._get_min_max_for_unit(this._line_config[lineCode]["unit"]));var min=$jscomp$destructuring$var5.next().value;var max=$jscomp$destructuring$var5.next().value;var span=max-min;return this._config["height"]-this._config["height"]*((value-min)/span)};
Wetplot.prototype._y_coord_to_value=function(lineCode,y_coord){var $jscomp$destructuring$var6=$jscomp.makeIterator(this._get_min_max_for_unit(this._line_config[lineCode]["unit"]));var min=$jscomp$destructuring$var6.next().value;var max=$jscomp$destructuring$var6.next().value;var span=max-min;return(this._config["height"]-y_coord)/this._config["height"]*span+min};
Wetplot.prototype._seconds_to_values=function(timestamp){var $jscomp$this=this;var $jscomp$destructuring$var7=$jscomp.makeIterator(this._nearestTwoDataRows(timestamp));var a=$jscomp$destructuring$var7.next().value;var b=$jscomp$destructuring$var7.next().value;var result={};var time_idx=this._data.heads.indexOf("Time");var aTs=a[time_idx];var bTs=b[time_idx];var exactPos=(timestamp-aTs)/(bTs-aTs);this.getAllLineCodes().forEach(function(lineCode){var idx=$jscomp$this._data.heads.indexOf(lineCode);var aVal=
a[idx];var bVal=b[idx];result[lineCode]=aVal+(bVal-aVal)*exactPos});return result};var WetplotData=function(heads,values){heads=heads===undefined?[]:heads;values=values===undefined?[]:values;this.heads=heads;this.values=values};WetplotData.prototype.getValue=function(rowIndex,columnName){return this.values[rowIndex][this.heads.indexOf(columnName)]};
WetplotData.concatenate=function(a,b){var result=new WetplotData;var heads_missing_in_a=[];var heads_missing_in_b=[];a.heads.forEach(function(head){if(b.heads.indexOf(head)===-1)heads_missing_in_b.push(head)});b.heads.forEach(function(head){if(a.heads.indexOf(head)===-1)heads_missing_in_a.push(head)});this._add_columns(a,heads_missing_in_a);this._add_columns(b,heads_missing_in_b);var aTime0=a.getValue(0,"Time");var bTime0=b.getValue(0,"Time");var time_cursor=Math.min(aTime0,bTime0);var a_cursor=0;
var b_cursor=0;while(a_cursor<a.values.length||b_cursor<b.values.length){var diffA=a.getValue(a_cursor,"Time")-time_cursor;var diffB=b.getValue(b_cursor,"Time")-time_cursor;if(diffA<=diffB)result.values.push()}return result};WetplotData._add_columns=function(data,columns,fillvalue){fillvalue=fillvalue===undefined?null:fillvalue;var num=columns.length;if(num<=0)return;var rowcount=data.values.length;for(var row=0;row<rowcount;row++)for(var i=0;i<num;i++)data.values[row].push(fillvalue);columns.forEach(function(col){return data.heads.push(col)})};
WetplotData.prototype.forEachObject=function(callbackFunction){var $jscomp$this=this;var obj={};this.values.forEach(function(row){for(var i=0;i<$jscomp$this.heads.length;i++)obj[$jscomp$this.heads[i]]=row[i];callbackFunction(Object.assign({},obj))})};
WetplotData.fromObjectArray=function(objArray){objArray=objArray===undefined?[]:objArray;var result=new WetplotData;objArray.forEach(function(obj){var row=[];Object.getOwnPropertyNames(obj).forEach(function(key){var colIndex=result.heads.indexOf(key);if(colIndex===-1){colIndex=result.heads.length;result.heads.push(key)}row[colIndex]=obj[key]});result.values.push(row)});result.values.sort(function(a,b){return a["Time"]>b["Time"]?1:b["Time"]>a["Time"]?-1:0});return result};
WetplotData.prototype.getMinMaxForColumn=function(colIndex){colIndex=colIndex===undefined?0:colIndex;var minVal=undefined;var maxVal=undefined;for(var i=0;i<this.values.length;i++){var val=this.values[i][colIndex];if(val<minVal||minVal===undefined)minVal=val;if(val>maxVal||maxVal===undefined)maxVal=val}return[minVal,maxVal]};
